## 1 : N ê´€ê³„

> Foreign Key

- ì™¸ë˜ í‚¤(ì™¸ë¶€ í‚¤)
- ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í•œ í…Œì´ë¸”ì˜ í•„ë“œ ì¤‘ ë‹¤ë¥¸ í…Œì´ë¸”ì˜ í–‰ì„ ì‹ë³„í•  ìˆ˜ ìˆëŠ” í‚¤
- ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì—ì„œ ì†ì„±(í•„ë“œ)ì— í•´ë‹¹í•˜ê³ , ì´ëŠ” ì°¸ì¡°ë˜ëŠ” í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤(Primary Key)ë¥¼ ê°€ë¦¬í‚´
- ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ëŠ” ì°¸ì¡°ë˜ëŠ” í…Œì´ë¸” í–‰ 1ê°œì— ëŒ€ì‘ë¨
  - ì´ ë•Œë¬¸ì— ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì—ì„œ ì°¸ì¡°ë˜ëŠ” í…Œì´ë¸”ì˜ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í–‰ì„ ì°¸ì¡°í•  ìˆ˜ ì—†ìŒ
- ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ í–‰ ì—¬ëŸ¬ ê°œê°€ ì°¸ì¡°ë˜ëŠ” í…Œì´ë¸”ì˜ ë™ì¼í•œ í–‰ì„ ì°¸ì¡°í•  ìˆ˜ ìˆìŒ
- âœ”ï¸ 1 ëŒ€ Nì´ë€, 1ê°œì˜ ê¸€ì— Nê°œì˜ ëŒ“ê¸€ì´ ì‘ì„±ë˜ëŠ” ê²ƒì„ ì˜ˆì‹œë¡œ ë³¼ ìˆ˜ ìˆë‹¤!!!!!

![image-20220413130706657](1N.assets/image-20220413130706657.png)



> Foreign Key íŠ¹ì§•

- í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶€ëª¨ í…Œì´ë¸”ì˜ `ìœ ì¼í•œ ê°’`ì„ ì°¸ì¡°(ì°¸ì¡° ë¬´ê²°ì„±)
- ì™¸ë˜ í‚¤ì˜ ê°’ì´ ë°˜ë“œì‹œ ë¶€ëª¨ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ì¼ í•„ìš”ëŠ” ì—†ì§€ë§Œ ìœ ì¼í•œ ê°’ì´ì–´ì•¼ í•¨

ğŸ‘‰`ì°¸ì¡° ë¬´ê²°ì„±` ì´ë€

- ë°ì´í„°ë² ì´ìŠ¤ ê´€ê³„ ëª¨ë¸ì—ì„œ ê´€ë ¨ëœ 2ê°œì˜ í…Œì´ë¸” ê°„ì˜ ì¼ê´€ì„±
- ì™¸ë˜ í‚¤ê°€ ì„ ì–¸ëœ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ ì†ì„±(ì—´)ì˜ ê°’ì€ ê·¸ í…Œì´ë¸”ì˜ ë¶€ëª¨ê°€ ë˜ëŠ” í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ ê°’ìœ¼ë¡œ ì¡´ì¬í•´ì•¼ í•¨



> ForeignKey field

- A many-to-ne relationship
- 2ê°œì˜ ìœ„ì¹˜ ì¸ìê°€ ë°˜ë“œì‹œ í•„ìš”
  - ì°¸ì¡°í•˜ëŠ” model class
  - on_delete ì˜µì…˜
- migrate ì‘ì—… ì‹œ í•„ë“œ ì´ë¦„ì— _idë¥¼ ì¶”ê°€í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ ì—´ ì´ë¦„ì„ ë§Œë“¦



----



```python
# articles ë‚´ë¶€ models.py

class Comment(models.Model):
    article = models.ForiegnKey(Article, on_delete=models.CASCADE)
    content = models.CharField(max_length=100)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)  
    
    def __str__(self):
        return self.content
```

âœ”ï¸ `on_delete`

- ì™¸ë˜ í‚¤ê°€ ì°¸ì¡°í•˜ëŠ” ê°ì²´ê°€ ì‚¬ë¼ì¡Œì„ ë•Œ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§„ ê°ì²´ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ì§€ë¥¼ ì •ì˜
- ë§ì¸ ì¦‰ìŠ¨ í•´ë‹¹ ê²Œì‹œê¸€ì„ ì‚­ì œí–ˆì„ ë•Œ, ê·¸ ê¸€ì— ë‹¬ë¦° ëŒ“ê¸€ë„ ê°™ì´ ì‚­ì œí• ì§€ ì–´ë–»ê²Œ í• ì§€ì— ëŒ€í•´ ì´ì•¼ê¸°í•œë‹¤.
- Database Integrity(ë°ì´í„° ë¬´ê²°ì„±)ì„ ìœ„í•´ì„œ ë§¤ìš° ì¤‘ìš”í•œ ì„¤ì •
- on_delete ì˜µì…˜ì— ì‚¬ìš© ê°€ëŠ¥í•œ ê°’ë“¤
  - `CASCADE` : ë¶€ëª¨ ê°ì²´(ì°¸ì¡°ëœ ê°ì²´)ê°€ ì‚­ì œëì„ ë•Œ ì´ë¥¼ ì°¸ì¡°í•˜ëŠ” ê°ì²´ë„ ì‚­ì œ
  - `PROTECT`
  - `SET_NULL`
  - `SET_DEFAULT`
  - SET()
  - DO_NOTHING
  - RESTRICT



> Migration

1. migrations ìƒì„±

```python
$ python manage.py makemigrations
```

2. migration íŒŒì¼ í™•ì¸

![image-20220413132423712](1N.assets/image-20220413132423712.png)

3. migrate

```python
$python manage.py migrate
```

4. articles_comment í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ ì»¬ëŸ¼ í™•ì¸(í•„ë“œ ì´ë¦„ì— `_id`ê°€ ì¶”ê°€ë¨ )

![image-20220413132504858](1N.assets/image-20220413132504858.png)



> ëŒ“ê¸€ ìƒì„± ì—°ìŠµí•˜ê¸°

```python
$ python manage.py shell_plus
```

![image-20220413150520436](1N.assets/image-20220413150520436.png)

ğŸ‘‰ ì´ë ‡ê²Œ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

articles_comment í…Œì´ë¸”ì˜ ForeignKeyField, article_id ê°’ì´ ëˆ„ë½ë˜ì—ˆê¸° ë–„ë¬¸!

![image-20220413150609648](1N.assets/image-20220413150609648.png)

- ê²Œì‹œê¸€ ìƒì„± í›„ ëŒ“ê¸€ ìƒì„± ì¬ì‹œë„

![image-20220413150640965](1N.assets/image-20220413150640965.png)

- ëŒ“ê¸€ ì†ì„± ê°’ í™•ì¸
  - ì‹¤ì œë¡œ ì‘ì„±ëœ ì™¸ë˜ í‚¤ ì»¬ëŸ¼ëª…ì€ article_idì´ê¸° ë•Œë¬¸ì— article_pkë¡œëŠ” ê°’ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŒ

![image-20220413150711374](1N.assets/image-20220413150711374.png)

- comment ì¸ìŠ¤í„´ìŠ¤ë¥¼ í†µí•œ article ê°’ ì ‘ê·¼

![image-20220413150728719](1N.assets/image-20220413150728719.png)

- ë‘ ë²ˆì§¸ ëŒ“ê¸€ ì‘ì„± í•´ë³´ê¸°

![image-20220413150747964](1N.assets/image-20220413150747964.png)

- admin siteì—ì„œ ì‘ì„±ëœ ëŒ“ê¸€ í™•ì¸í•˜ê¸°



> 1:N ê´€ê³„ related manager

- ì—­ì°¸ì¡°('comment_set')
  - Article(1) -> Comment(N)
  - article.comment í˜•íƒœë¡œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ê³ , article.`comment_set` managerê°€ ìƒì„±ë¨
  - ê²Œì‹œê¸€ì— ëª‡ ê°œì˜ ëŒ“ê¸€ì´ ì‘ì„± ë˜ì—ˆëŠ”ì§€ Django ORMì´ ë³´ì¥í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸
    - articleì€ commentê°€ ìˆì„ìˆ˜ë„ ìˆê³ , ì—†ì„ ìˆ˜ë„ ìˆìŒ
    - `ì‹¤ì œë¡œ Article í´ë˜ìŠ¤ì—ëŠ” Commentì™€ì˜ ì–´ë– í•œ ê´€ê³„ë„ ì‘ì„±ë˜ì–´ ìˆì§€ ì•ŠìŒ`
- ì°¸ì¡°('article')
  - Comment(N) -> Article(1)
  - ëŒ“ê¸€ì˜ ê²½ìš° ì–´ë– í•œ ëŒ“ê¸€ì´ë“  ë°˜ë“œì‹œ ìì‹ ì´ ì°¸ì¡°í•˜ê³  ìˆëŠ” ê²Œì‹œê¸€ì´ ìˆìœ¼ë¯€ë¡œ , comment.articleê³¼ ê°™ì´ ì ‘ê·¼í•  ìˆ˜ ìˆìŒ
  - ì‹¤ì œ ForeignKeyField ë˜í•œ Comment í´ë˜ìŠ¤ì—ì„œ ì‘ì„±ë¨



> 1:N related manager ì—°ìŠµí•˜ê¸°

1. dir() í•¨ìˆ˜ë¥¼ í†µí•´ article ì¸ìŠ¤í„´ìŠ¤ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì†ì„±, ë©”ì„œë“œë¥¼ ì§ì ‘ í™•ì¸í•˜ê¸°

![image-20220413151343518](1N.assets/image-20220413151343518.png)

2. articleì˜ ì…ì¥ì—ì„œ ëª¨ë“  ëŒ“ê¸€ ì¡°íšŒí•˜ê¸°(ì—­ì°¸ì¡°, 1->N)

![image-20220413151419585](1N.assets/image-20220413151419585.png)

3. ì¡°íšŒí•œ ëª¨ë“  ëŒ“ê¸€ ì¶œë ¥í•˜ê¸°

![image-20220413151434828](1N.assets/image-20220413151434828.png)

4. commentì˜ ì…ì¥ì—ì„œ ì°¸ì¡°í•˜ëŠ” ê²Œì‹œê¸€ ì¡°íšŒí•˜ê¸°(ì°¸ì¡°, N->1)

![image-20220413151515648](1N.assets/image-20220413151515648.png)



> ForeignKey arguments - 'related_name'

- ì—­ì°¸ì¡° ì‹œ ì‚¬ìš©í•  ì´ë¦„('model_set' manager)ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ì˜µì…˜

![image-20220413151556522](1N.assets/image-20220413151556522.png)

- ìœ„ì™€ ê°™ì´ ë³€ê²½í•˜ë©´ article.comment_setì€ ë” ì´ìƒ ì‚¬ìš©í•  ìˆ˜ ì—†ê³ , `article.comments`ë¡œ ëŒ€ì²´ë¨
- ì—­ì°¸ì¡° ì‹œ ì‚¬ìš©í•  ì´ë¦„ ìˆ˜ì • í›„, migration ê³¼ì • í•„ìš”



-----



### Comment CREATE

```python
# articles/forms.py

from .models import Article, Comment

class CommentForm(forms.ModelForm):
    class Meta:
        model = Comment
        # fields = '__all__'
        # fieldsë¡œ ëª¨ë“ ê±¸ ë³´ì—¬ì£¼ë©´ ForeignKeyFieldë¥¼ ì‘ì„±ìê°€ ì§ì ‘ ì…ë ¥í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ë°œìƒ
        exclude = ('articles',)
```

![image-20220413152211604](1N.assets/image-20220413152211604.png)

ğŸ‘‰ ì´ëŸ° ìƒí™©ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ excludeë¥¼ ì‘ì„±í•´ì¤€ë‹¤.

```python
# articles/views.py
# ê¸°ì¡´ ê²Œì‹œê¸€ detail í˜ì´ì§€ì—ì„œ commentë§Œ ì¶”ê°€í•œ ê²ƒ

from .forms import ArticleForm, CommentForm

def detail(request,pk):
    article = get_object_or_404(Article, pk=pk)
    comment_form = CommentForm()
    context = {
        'article' : article,
        'comment_form' : comment_form,
    }
    return render(request,'articles/detail.html',context)
```

```html
<!-- articles/detail.html -->

....
<a href="{% url 'articles:index' %}"BACK</a>
<hr>
<form action="" method="POST">
   	{% csrf_token %}
   	{{ comment_form }}
    <input type="submit>"
</form>

```



> ëŒ“ê¸€ ì‘ì„± ë¡œì§

![image-20220413152329935](1N.assets/image-20220413152329935.png)

![image-20220413152354108](1N.assets/image-20220413152354108.png)



> THe 'save()' method

- save(commit=False)
  - ì•„ì§ `ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ì§€ ì•Šì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜`
  - ì €ì¥í•˜ê¸° ì „ì— `ê°ì²´ì— ëŒ€í•œ ì‚¬ìš©ì ì§€ì • ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•  ë•Œ`ìœ ìš©í•˜ê²Œ ì‚¬ìš©



> ëŒ“ê¸€ ì¶œë ¥

íŠ¹ì • articleì— ìˆëŠ” ëª¨ë“  ëŒ“ê¸€ì„ ê°€ì ¸ì˜¨ í›„ contextì— ì¶”ê°€

```python
# articles/views.py

from .models import Article, Comment

def detail(request,pk):
    article = get_object_or_404(Article,pk=pk)
    comment_form = CommentForm()
    comments = article.comment_set.all()
    context = {
        'article' : article,
        'comment_form' : comment_form,
        'comments' : comments,
    }
    return render(request,'articles/detail.html',context)
```

```html
<!-- articles/detail.html -->

...
<a href="{% url 'articles:index' %}">BACK</a>
<hr>
<h4>ëŒ“ê¸€ ëª©ë¡</h4>
<ul>
    {% for comment in comments %}
    	<li>{{ comment.content }}</li>
    {% endfor %}
</ul>
```



----

### Comment DELETE

![image-20220413153119763](1N.assets/image-20220413153119763.png)

`if request.user.is_authenticated:`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ëœ ì‚¬ìš©ìì˜ ê²½ìš°ë§Œ ëŒ“ê¸€ ì‘ì„± ë° ì‚­ì œí•˜ë„ë¡ í•˜ê¸°





-----



### COmment ì¶”ê°€ì‚¬í•­

> ëŒ“ê¸€ ê°œìˆ˜ ì¶œë ¥í•˜ê¸°

![image-20220413153141165](1N.assets/image-20220413153141165.png)



> ëŒ“ê¸€ì´ ì—†ëŠ” ê²½ìš° ëŒ€ì²´ ì»¨í…ì¸  ì¶œë ¥(DTLì˜ for-empty íƒœê·¸ í™œìš©)

![image-20220413153226526](1N.assets/image-20220413153226526.png)





-----



### Substituting a custom User model

> User ëª¨ë¸ ëŒ€ì²´í•˜ê¸°

- ì¼ë¶€ í”„ë¡œì íŠ¸ì—ì„œëŠ” Djangoì˜ ë‚´ì¥ User ëª¨ë¸ì´ ì œê³µí•˜ëŠ” ì¸ì¦ ìš”êµ¬ì‚¬í•­ì´ ì ì ˆí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
  - ex) username ëŒ€ì‹  emailì„ ì‹ë³„ í† í°ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì í•©í•œ ì‚¬ì´íŠ¸
- DjangoëŠ” Userë¥¼ ì°¸ì¡°í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” `AUTH_USER_MODEL` ê°’ì„ ì œê³µí•˜ì—¬, default user modelì„ ì¬ì •ì˜(override)í•  ìˆ˜ ìˆë„ë¡ í•¨
- DjangoëŠ” ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ëŠ” ê²½ìš° ê¸°ë³¸ ì‚¬ìš©ì ëª¨ë¸ì´ ì¶©ë¶„í•˜ë”ë¼ë„, ì»¤ìŠ¤í…€ ìœ ì € ëª¨ë¸ì„ ì„¤ì •í•˜ëŠ” ê²ƒì„ ê°•ë ¥í•˜ê²Œ ê¶Œì¥
  - ë‹¨, í”„ë¡œì íŠ¸ì˜ ëª¨ë“  migrations í˜¹ì€ ì²« migrateë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì— ì´ ì‘ì—…ì„ ë§ˆì³ì•¼ í•¨



> AUTH_USER_MODEL

- Userë¥¼ ë‚˜íƒ€ë‚˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” ëª¨ë¸
- í”„ë¡œì íŠ¸ê°€ ì§„í–‰ë˜ëŠ” ë™ì•ˆ ë³€ê²½í•  ìˆ˜ ì—†ìŒ
- í”„ë¡œì íŠ¸ ì‹œì‘ ì‹œ ì„¤ì •í•˜ê¸° ìœ„í•œ ê²ƒì´ë©°, ì°¸ì¡°í•˜ëŠ” ëª¨ë¸ì€ ì²«ë²ˆì§¸ ë§ˆì´ê·¸ë ˆì´ì…˜ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì•¼ í•¨
- ê¸°ë³¸ ê°’ : 'auth.User'(auth ì•±ì˜ User ëª¨ë¸)



> Custom User ëª¨ë¸ ì •ì˜í•˜ëŠ” ë‹¨ê³„

1. ê´€ë¦¬ì ê¶Œí•œê³¼ í•¨ê»˜ ì™„ì „í•œ ê¸°ëŠ¥ì„ ê°–ì¶˜ User ëª¨ë¸ì„ êµ¬í˜„í•˜ëŠ” ê¸°ë³¸ í´ë˜ìŠ¤ì¸ AbstactUserë¥¼ ìƒì†ë°›ì•„ ìƒˆë¡œìš´ User ëª¨ë¸ ì‘ì„±

```python
from django import models
from django.contrib.auth.models import AbstactUser

class User(AbstractUser):
    pass
```

2. ê¸°ì¡´ì— Djangoê°€ ì‚¬ìš©í•˜ëŠ” User ëª¨ë¸ì´ì—ˆë˜ auth ì•±ì˜ User ëª¨ë¸ì„ accounts ì•±ì˜ User ëª¨ë¸ì„ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½

```python
# settings.py
AUTH_USER_MODEL = 'accounts.User'
```

3. admin siteì— Custom User ëª¨ë¸ ë“±ë¡

```python
# accounts/admin.py

from django.contrib.auth.admin import UserAdmin
from .models import User

admin.site.register(User,UserAdmin)
```

4. í”„ë¡œì íŠ¸ ì¤‘ê°„ì— ì§„í–‰í–ˆê¸° ë•Œë¬¸ì— ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì´ˆê¸°í™”í•œ í›„ ë§ˆì´ê·¸ë ˆì´ì…˜ ì§„í–‰
   1. db.sqlite3 íŒŒì¼ ì‚­ì œ
   2. migrations íŒŒì¼ ëª¨ë‘ ì‚­ì œ(íŒŒì¼ëª…ì— ìˆ«ìê°€ ë¶™ì€ íŒŒì¼ë§Œ ì‚­ì œ)









### 1:N









ì¥ê³ ì—ì„œ appì´ ì‹¤í–‰ë˜ëŠ” ìˆœì„œ

1. INSTALLED_APPì—ì„œ ìˆœì°¨ì ìœ¼ë¡œ APP import
2. ê° ì•±ì˜ modelsë¥¼ import
3. 