#### 간단한 라우팅 프로토콜

- 최단 경로 라우팅
  - ![image-20230227193108126](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227193108126.png)
  - 거리 기준은 다양하지만 중간에 거쳐가는 홉(hop) 수로 판단
  - 패킷이 목적지로 가는 동안 거치는 라우터 수가 최소가 되도록 경로를 선택
  - 기타 거리 기준
    - 패킷의 전송 지연, 전송 대역폭, 통신 비용 등

- 플러딩(flooding)
  - 라우터가 입력된 패킷을 출력 가능한 모든 경로로 중개하는 방식
  - 네트워크에 패킷이 무한 개 만들어질 위험
    - 홉 수를 일정 범위로 제한하고, 제거
  - 중요한 데이터를 모든 호스트에게 동시에 전달하는 환경에서 제한적으로 사용



#### 거리-벡터 프로토콜

- 라우터가 자신과 직접 연결된 주변 라우터에게 라우팅 정보를 교환하는 방식
  - 전체 네트워크에 대한 지식
  - 이웃 라우터에게만 전달
  - 일정한 주기로 정보 공유
- 교환 정보는 전체 네트워크에 속하는 개별 네트워크까지 걸리는 거리 정보
- 개별 라우터에서 유지하는 필수 정보
  - 링크 벡터 : 직접 연결된 네트워크에 대한 연결 정보
  - 거리 벡터 : 전체 개별 네트워크에 대한 거리 정보
  - 다음 홉 벡터 : 개별 네트워크로 가기 위한 다음 홉 정보

![image-20230227194455307](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227194455307.png)



- RIP(Routing Information Protocol)
  - 거리 벡터 방식
  - 소규모 네트워크 환경에 적합
  - 주변 라우터가 제공하는 거리 벡터 정보가 임의의 짧은 시간 내에 모두 도착해야
    - 현실적으로 구현이 어려움(UDP 사용 - 패킷 손실 가능성)
  - 라우팅 정보 수정하는 경우
    - 거리 벡터 정보가 새로운 네트워크 주소면 적용
    - 목적지까지의 지연이 더 적으면 기존 경로를 대체
    - 거리 벡터 정보가 입력되면 등록 정보를 수정
  - 패킷 구조
    - ![image-20230227195733841](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227195733841.png)
  - Command
    - 1이면 요구
    - 0이면 응답
    - 초기에 요구를 받으면 즉시 응답해야 함
  - IP Address
    - 네트워크 지칭
  - Metric
    - 목적지까지의 거리

![image-20230227194945990](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227194945990.png)

![image-20230227195015024](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227195015024.png)

![image-20230227195057550](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227195057550.png)

![image-20230227195502773](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227195502773.png)

![image-20230227195508644](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227195508644.png)



#### 링크 상태 프로토콜

- 거리-벡터 프로토콜의 단점 개선
  - 주변 상황에 변화가 있을 때
  - 주변 라우터까지의 정보를
  - 모든 라우터에게 전달
- 플러딩(Flooding) 방식을 사용해서 정보 전달
- OSPF(Open Shortest Path First) 프로토콜



#### OSPF 토폴로지

![image-20230227195911798](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227195911798.png)

- 5개의 OSPF 라우터(R1 ~ R5)가 존재
- 라우터간 연결 링크에 대한 IP 주소와 OSPF Cost 및 각 라우터의 Loopback 주소(ex. R1의 경우 10.1.0.1)가 표시
- 파란색 줄(링크)가 OSPF가 enable되어 있음을 표시

- R1이 자신의 링크 정보를 다른 OSPF 라우터들로 전파

  ![image-20230227200020127](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227200020127.png)

  - 이를 수신한 R2, R3는 Router-LSA가 수신된 링크를 제외한 나머지 링크로 Router-LSA를 flooding
  - R4와 R5는 동일한 Router-LSA를 2개씩 수신
    - LSA 식별자에 해당하는 {LS Type, Link State ID, Advertising Router}가 동일한 경우 두 번째 수신한 LSA를 폐기

- R2가 자신의 링크 정보를 다른 OSPF 라우터들로 전파

  ![image-20230227200223592](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227200223592.png)

  - 이를 수신한 R1, R4, R5는 Router-LSA가 수신된 링크를 제외한 나머지 링크로 Router-LSA를 flooding
  - R3는 동일한 Router-LSA를 3개 수신

- R3가 자신의 링크 정보를 다른 OSPF 라우터들로 전파

  ![image-20230227200334042](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227200334042.png)

  - 이를 수신한 R1, R4, R5는 Router-LSA가 수신된 링크를 제외한 나머지 링크로 Router-LSA를 flooding

- R4가 자신의 링크 정보를 다른 OSPF 라우터들로 전파

  ![image-20230227200431991](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227200431991.png)

  - 이를 수신한 R2, R3는 Router-LSA가 수신된 링크를 제외한 나머지 링크로 Router-LSA를 flooding

- R5가 자신의 링크 정보를 다른 OSPF 라우터들로 전파

  ![image-20230227200515978](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227200515978.png)

  - 이를 수신한 R2, R3는 Router-LSA가 수신된 링크를 제외한 나머지 링크로 Router-LSA를 flooding



#### 외부 라우팅 프로토콜

- 외부 라우팅 프로토콜에서 사용하는 경로 벡터(Path Vector)는 경로에 관한 거리 정보 값이 필요 없는 방식
- 내부 라우팅 프로토콜과의 차이
  - 거리(비용)에 대한 처리 과정이 없음
  - 목적지 네트워크에 도착하기 위한 자율시스템에 대한 내용만 포함
- BGP(Border Gateway Protocol)
  - 인터넷에서 많이 사용
  - 서로 다른 종류의 자율시스템 간 정보 교환 가능
  - TCP를 이용하여 정보 교환
  - 메시지 종류
    - Open
      - 연관(Relationship) 생성
    - Update
      - 경로 관련 정보 전달
    - KeepAlive
      - Open에 대한 응답 기능과 주기적인 연관 확인 기능
    - Notification
      - 오류 상태 통보



#### BGP

![image-20230228123649740](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230228123649740.png)

- 계층적 라우팅 필요성
  - 평면적 라우팅은 확장이 어려움
    - 저장 공간, 합의에 도달하는 시간, 통신
  - 목적지에 이르는 거리가 멀수록 더 적은 정보를 이용하는 것이 타당
  - 해결 방안 : 영역 계층구조 (Area Hierarchy)
- 영역(area)
  - 망을 영역들로 분할
    - 각 영역에 서브-영역 존재 가능
  - 망 노드는 계층적 주소 부여
  - 영역 내부
    - 각 노드는 다른 노드로 가는 경로 보유
  - 영역 외부
    - 각 노드는 다른 top-level 영역으로 가는 경로만 보유
    - 영역 간 패킷은 적절한 border router에게 전달

- 인터넷의 영역 계층구조
  - 자율시스템(AS : Autonomous System)
    - 하나의 기술적 관리 하에 있는 라우터들의 집합
      - AS 안에서는 IGP(Interior gateway protocol)와 패킷을 전달하기 위한 공통 메트릭 이용
      - 다른 AS로 전달하기 위해서는 EGP(exterior gateway protocol) 사용
    - 가끔 하나의 AS 안에서 여러 IGP를 이용할 수도 있지만, 외부에는 하나의 AS로만 인식됨
  - 각 AS는 유일한 ID 할당
  - AS는 피어(peer) 역할

![image-20230228123829929](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230228123829929.png)