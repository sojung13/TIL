### 16-1 파일 전송을 위한 사용자 환경

#### 개요

#### FTP(File Transfer Protocol)

✅ 이용자의 PC와 쇼핑몰 호스팅 서버 간 파일을 송수신하는 프로그램. `파일 전송 전용 프로토콜`이기 때문에, 많은 양의 파일을 일괄적으로 주고 받을 때 효과적이다!!

- FTP : FTP 클라이언트와 FTP 서버 사이의 파일 송수신 기능을 제공
- FTP 로그인
  - 원격 시스템에 접속하려면 FTP 서버에 등록된 로그인 계정과 암호가 필요
  - 익명 FTP 로그인
    - 다중 사용자를 위한 로그인 계정
      - 로그인 계정 : anonymous
      - 암호 : 관례상 자신의 메일 주소



#### 익명 FTP 로그인

![image-20230308171145860](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308171145860.png)

- unix 모델이고, 파일을 전송하기 위해 바이너리 모드를 사용한다.



#### FTP 로그인

![image-20230308171200738](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308171200738.png)



#### 사용자 파일 전송 명령

![image-20230308171213007](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308171213007.png)

- 서버와 클라이언트 사이에 주고 받는 명령이 아니라 클라이언트에서(프로그램에서) 쓸 수 있는 명령 => 내가 클라이언트한테 보내는 명령!



#### 파일 전송 명령 실행 예

- ls 명령 : 원격 디렉토리 목록을 검색

  - README, Book, hong12.Dec00.tar.Z라는 파일 세 개가 존재
  - 총 34 바이트의 파일이었고 0.04초 정도 걸렸다

  ![image-20230308171250902](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308171250902.png)

- get 명령 : 임의의 파일을 가져옴

![image-20230308171305919](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308171305919.png)

- put 명령 : 원격 시스템으로 파일을 송신
- dc, lcd 명령 : 복사되는 파일의 위치를 조정하여 디렉토리를 이동함



---



### 16-2 FTP 원리

#### FTP 구조

- 2개의 채널 존재
  - **제어 채널**
    - FTP 프로토콜의 `명령`과 `응답` 전송
  - **데이터 채널**
    - 복사하려는 `파일`의 내용 전송
- 구성 요소
  - 사용자 인터페이스 모듈
  - 명령 송수신 모듈
  - 파일 송수신 모듈
  - Well-known 포트

![image-20230308171418146](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308171418146.png)

- 요소별 기능
  - **사용자 인터페이스 모듈**
    - 사용자 명령을 해석하여 명령 송수신 모듈에 전달
  - **명령 송수신 모듈**
    - 제어 채널 설정(클라이언트가 초기화)
    - 사용자 명령을 FTP 명령으로 전환하여 제어 채널로 전송
  - **파일 송수신 모듈**
    - 파일 송수신 요구가 발생할 때마다 데이터 채널 설정(서버가 초기화)
    - 데이터 채널을 통하여 파일 복사, 파일 목록 전송 기능 수행
- Well-known 포트
  - 제어 채널 : TCP 21번
  - 데이터 채널 : TCP 20번



#### 데이터 채널의 설정

![image-20230308171535287](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308171535287.png)



#### FTP 명령과 응답

- 제어 채널을 이용하여 FTP 명령과 응답을 전송

![image-20230308171557731](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308171557731.png)



#### FTP 명령

![image-20230308171608077](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308171608077.png)

![image-20230308171614982](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308171614982.png)



#### FTP 응답

- 3자리 응답 코드와 설명문으로 구성
  - 첫 번째 숫자가 2인 경우 : 성공
  - 첫 번째 숫자가 5인 경우 : 실패
  - 첫 번째 숫자가 3인 경우 : 정상적이긴 한데 뭔가 추가적인게 필요한 경우
  - 그 외는 연속 동작 지원 용도

![image-20230308171644883](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308171644883.png)



#### FTP 로그인 과정

![image-20230308171657330](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308171657330.png)

- FTP 로그인 예
  - 텔넷 프로그램을 이용한 FTP 로그인 과정
    - FTP 서버는 uu.ac.kr 호스트라고 가정
    - telnet uu.ac.kr 21 명령을 입력
    - USER, PASS 명령
    - FTP 서버의 현재 디렉토리 이름인 /export/faculty/kihyun의 메시지를 서버가 회신함
    - FTP 세션을 종료하기 위한 QUIT 명령

![image-20230308171800968](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308171800968.png)



#### FTP 파일 송수신

- FTP 파일 송수신 절차
  - 클라이언트에서 데이터 채널 생성
  - PORT 명령
    - 생성한 포트 번호 전달
  - RETR/STOR (파일 송수신 명령) 전달
  - 데이터 채널 연결
  - 데이터 전송
  - 데이터 채널 종료
  - 서버에서 응답 코드 전송

![image-20230308171852750](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308171852750.png)



----



### 16-3 TFTP

#### TFTP 개요

- Trivial File Transfer Protocol
  - 하찮은, 일반적인 파일 전송 프로토콜! FTP 보다 좀 더 심플,간단하고 기능이 축소된 전송 프로토콜
- 임의의 시스템이 원격시스템으로부터 부팅(booting) 코드를 다운로드할 때 사용하는 프로토콜
  - 자체적으로 하드디스크를 보유하지 못한 X-terminal과 같은 장치
- 기존 FTP
  - TCP/IP 전체 프로토콜 스택
  - 2개의 채널(제어, 데이터)
  - 디렉토리/파일 관리
- FTP 기능 대폭 축소하여 경량화
  - TCP 대신 UDP 사용
  - 복잡한 디렉토리, 파일 관리 기능 제거
  - 오직 하나의 파일 복사
- UDP 69번 포트



#### TFTP 명령

- FTP보다 명령이 단순화된 모습이다

![image-20230308172033349](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308172033349.png)



#### 세션의 설정과 읽기

- UDP에는 연결 기능이 없으므로, 각 데이터 블록을 독립적으로 전송
- RRQ를 보내면 세션 설정
- DATA를 이용해 데이터를 전송하면 그대로 유지
- 마지막 DATA는 512 바이트보다 작은 데이터 블록을 보내면 세션 해제
  - 데이터는 무조건 512 바이트로 잘라보내기 때문에 그 이하로 전송되면 세션이 해제된다.
- 파일을 보내는 서버는 DATA, 클라이언트는 ACK만 사용

![image-20230308172126165](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308172126165.png)



#### 데이터 쓰기

- WRQ를 보내면 세션 설정
- 파일을 보내는 클라이언트는 DATA, 서버는 ACK만 사용

![image-20230308172156440](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308172156440.png)



#### 데이터 전송

- 데이터 블록 전송을 하나씩 처리하는 흐름 제어 방식
  - 데이터 도착 순서가 바뀔 수 없음
- 데이터가 분실되는 경우
  - 송신 측의 타이머 이용
- ACK가 분실되는 경우
  - 송신 측의 타이머 이용
    - 데이터가 안오면(타임아웃) 데이터가 분실된 것으로 판단하고 다시 ACK를 보낸다!
  - ACK를 보낸 후 주어진 시간 내에 다음 데이터가 도착해야만 계속 진행
- TFTP는 NAK을 지원하지 않음

![image-20230308172251675](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230308172251675.png)