### 이동 IP

#### 배경

- 기존의 고정통신망에서 유무선이 복합된 이동 광대역 통신망으로 진화
- 이동환경서비스 수용 필요
- 관련 개념
  - 핸드오버(hand-over) (또는 핸드오프(hand-off))
  - 로밍(Roaming)



#### Hand-off

![image-20230301150818793](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230301150818793.png)

- MS(Mobile Station)가 움직일수록 BS1의 신호보다 BS2의 신호가 강해진다. 그래서 서비스가 넘어가면 BS2가 할 수 있도록.
- 사용자는 계속해서 서비스를 이용



#### 2G(GSM) 구조

![image-20230301151051525](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230301151051525.png)

- Base Station Subsystem : 기지국
- BTS에서 MS를 감지하면 VLR에 등록을 해준다.



#### 이동통신망 구조

![image-20230301170148015](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230301170148015.png)

- 처음엔 음성만 송수신되도록 했지만 시대가 지나며 다양한 데이터를 주고받을 수 있도록 하였다.



#### 3G 네트워크 예 (UMTS / GSM 구조)

![image-20230301170551947](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230301170551947.png)



#### 3G 네트워크 프로토콜 스택

![image-20230301170718070](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230301170718070.png)



#### Roaming

![image-20230301170743856](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230301170743856.png)



#### 터널링 원리

- 상이한 전송 수단
  - 버스라는 헤더, 배라는 헤더를 상이하게 선택하여 수단으로 활용한다.

![image-20230301173257951](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230301173257951.png)

- 터널링

![image-20230301173420901](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230301173420901.png)



- 주소 표현
  - 통신할 상대방을 구분하기 위해 주소(Address) 필요
  - 이동망 환경에서 주소 처리
    - 이동한 위치에서 새로운 IP 주소 할당
    - 호스트 고유의 주소 유지
  - 기존 IP 주소가 가진 두 가지 기능
    - 호스트 식별
    - 경로(위치)

- 에이전트(Agent)
  - 두 종류의 주소 사용
    - Home Address
      - 이동 호스트를 위한 고정 주소
      -  HA(Home Agent)
        - 이동 호스트를 위한 고정 위치에서 FA로의 연결 처리
    - COA(Care of Address)
      - 이동 호스트를 위한 임시 가변 주소(일시적 할당)
      - FA(Foreign Agent)
        - 이동 호스트에서 근접한 FA
        - COA 관리 및 HA와의 터널 관리
  - 호스트가 이동할 때의 처리
    - HA는 변하지 않고 FA만 변함
    - 따라서 HA와 새로운 FA 사이에 터널 설정
  - 패킷 전달 과정
    - 이동 호스트를 목적지로 하는 패킷은 HA에게 전달
    - HA는 FA에게 패킷 전달
    - FA는 이동 호스트에게 패킷 전달

![image-20230301173801345](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230301173801345.png)

- IP 터널

  ![image-20230301174216689](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230301174216689.png)

  - 터널 구간에서 IP 캡슐링 방식으로 패킷을 중개
    - 원 패킷 : 송신 호스트가 전송하고, 수신 호스트가 수신 받는 패킷
    - IP 캡슐 패킷 : 터널 구간에서 원 패킷을 IP 캡슐화
  - 추가된 헤더의 목적지에 COA가 들어감

