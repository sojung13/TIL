### 6-1 데이터 링크 계층 프로토콜의 기초

#### 연결 구성

![image-20230227162341550](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227162341550.png)

- 점대점(Point-to-point)
- 멀티드롭(multi drop)
  - `주소(address) 개념` 필요



#### 프레임 종류

![image-20230228134052946](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230228134052946.png)

- 정보 프레임 : **I 프레임**
  - 상위 계층이 전송 요구한 데이터를 `송신`하는 용도
  - 순서번호, 송수신 호스트 정보 등이 포함됨
- 긍정 응답 프레임 : **ACK 프레임**
  - `전송 데이터가 올바르게 도착했음`을 회신하는 용도
  - 데이터를 수신한 호스트가 데이터를 송신한 호스트에게 전송
- 부정 응답 프레임 : **NAK 프레임**
  - `전송 데이터가 깨져서 도착했음`을 회신하는 용도
  - 데이터를 수신한 호스트가 데이터를 송신한 호스트에게 전송
  - 데이터를 송신한 호스트는 원래의 데이터를 재전송하여 오류 복구
- ❗긍정 응답, 부정 응답 프레임 모두 회신하고자 하는 I 프레임 순서 번호 포함
  - 제대로 도착한 프레임과 오류가 발생한 프레임 판단 가능



#### 오류, 흐름 제어가 없는 프로토콜

- 가정
  - 단방향 통신
    - 송신 호스트에서 수신 호스트 한 쪽 방향으로만 데이터 전송
  - 전송 오류가 없는 물리 매체
    - 어떠한 전송 오류도 발생하지 않음
  - 무한 개의 수신 버퍼
    - 흐름 제어 기능이 필요 없음
- `단순 프로토콜`
  - ![image-20230227163814628](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227163814628.png)
  - 송신 호스트는 원하는 만큼 자유롭게 프레임을 전송할 수 있음
  - 오류 제어 없음
    - 프레임 분실/ 변형 오류가 발생하지 않음
  - 흐름 제어 없음
    - 수신 버퍼가 무한이므로 분실 오류 없음
  - 순서번호도 불필요



#### 오류 제어가 없는 프로토콜

- 오류 제어는 없지만 흐름제어는 필요한 프로토콜

- 가정
  - 단방향 통신
    - 송신 호스트에서 수신 호스트 한 쪽 방향으로만 데이터 전송
  - 전송 오류가 없는 물리 매체
    - 어떠한 전송 오류도 발생하지 않음
  - 전송 오류는 없으나 버퍼 부족으로 프레임 분실 가능

- `정지-대기 프로토콜 1`
  - ![image-20230227164009566](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227164009566.png)
  - 수신 버퍼의 개수가 유한
    - 흐름 제어 필요
  - 이전 프레임을 잘 받았다는 긍정 응답 기능과 수신 호스트가 송신 호스트의 전송 시점을 지정하기 위한 ACK 프레임 필요
    - 이때 프레임은 앞에서 잘 받았다, 다음거 보내도 좋다라는 두 가지 의미를 포함하고 있음
  - 데이터의 중복 수신 우려가 있으며 순서 번호 기능 필요
  - 정지-대기(Stop-and-wait)
    - 하나의 프레임 전송 후 응답 대기
    - 전송 효율이 떨어지므로 잘 사용하지 않음



#### 단방향 프로토콜

- 가정
  - 단방향 통신 : 송신 호스트에서 수신 호스트 한 쪽 방향으로만 데이터 전송
  - 전송 매체 오류 발생 가능
  - 버퍼 유한
- 오류 제어와 흐름 제어가 모두 필요
- 프레임 변형 오류를 해결 방안
  - 수신 호스트의 NAK 기능 필요
  - 송신 호스트의 타임아웃 기능 필요



#### 단방향 프로토콜-NAK가 없는 경우

- 정보 프레임 분실
  - ![image-20230227164156823](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227164156823.png)
  - 송신 호스트의 타임아웃 기능으로 오류 복구

- ACK 프레임 분실
  - ![image-20230227164231536](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227164231536.png)
  - 송신 호스트의 타임아웃 기능으로 오류 복구

- 정보 프레임 변형
  - ![image-20230227164253629](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227164253629.png)
  - 송신 호스트의 타임아웃 기능으로 오류 복구



#### 단방향 프로토콜 - NAK가 있는 경우

- 정보 프레임 변형 오류
  - ![image-20230227164331754](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227164331754.png)
  - NAK를 이용하여 통보
    - 더 효율적일 수 있음
      - 즉시 통보해서 바로 재전송할 수 있기 때문에 더 빠르게 대처 가능
    - 다른 요인에 의해 NAK를 사용하지 못하는 경우도 있음

- 정보 프레임 분실 오류
  - ![image-20230227164358713](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227164358713.png)
  - 타임아웃으로 인지 - 재전송



----



### 6-2 슬라이딩 윈도우 프로토콜

#### 슬라이딩 윈도우

- `양방향 통신`을 지원
- `오류 제어`와 `흐름 제어`를 함께 지원
- 기본 절차

1. 송신 호스트는 정보 프레임(전송 데이터 + 순서 번호 + 오류 검출 코드)을 `순서 번호`에 따라 순차적으로 전송함
2. 정보 프레임을 수신한 수신 호스트가 응답하는 순서 번호는 정상적으로 수신한 번호가 아닌, 다음에 수신하기를 기대하는 번호를 회신하는 것이 일반적임
3. 송신 호스트가 관리하는 송신 윈도우는 전송은 되었지만 긍정 응답이 회신하지 않은 프레임을 보관함
4. 수신 호스트가 관리하는 수신 윈도우는 프로토콜의 동작 방식에 따라 크기가 다름
   - 선택적 재전송(Selective Repeat) 방식에서는 송신 윈도우 크기와 같음
   - Go-back N 방식에서는 크기가 1 임



#### 흐름 제어

- 순서 번호
  - 프레임 별로 부여되는 일련 번호
  - 0부터 임의의 최댓값까지 순환 방식으로 사용
  - 일반적으로 순서 번호의 최댓값이 송신 윈도우 크기보다 커야 함
  - 프레임에서 순서 번호의 공간 크기 = n 비트 : 순서 번호의 범위는 0 _ 2^n - 1
  - Stop-and-wait 방식의 경우 n=1인 특별한 경우

- 윈도우 크기
  - 긍정 응답 프레임을 받지 않고도 연속으로 전송할 수 있는 프레임의 최대 개수

![image-20230227164725535](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227164725535.png)

=> 왼쪽 그림과 오른쪽 그림의 송수신 과정 살펴보기



#### 연속형 전송

- 정지-대기 프로토콜은 송신 윈도우 크기가 1인 경우
  - 프레임 전송 시간이 오래 걸리는 경우 전송 효율이 극단적으로 떨어짐
- 연속형 전송(pipelining)
  - ACK 프레임을 받지 않고 여러 프레임을 연속으로 전송
  - 전송 오류 발생 가능성이 적은 환경에서는 상당히 효율적
  - 오류 발생이 가능하므로 해결 방안이 필요
    - Go-back N
      - ![image-20230227164859688](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227164859688.png)
      - 오류가 발생한 12번 프레임을 포함해 이후에 전송된 모든 정보 프레임을 재전송
    - 선택적 재전송(Selective Repeat)
      - ![image-20230227164932896](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227164932896.png)
      - 오류가 발생한 프레임만 선택적으로 복구하는 방식
      - 부정 응답 프레임을 사용해 오류가 발생한 정보 프레임을 처리하는 경우



#### 피기배킹(Piggybacking)

- 피기백은 일반적으로 돼지저금통을 의미

- 양방향 전송의 경우
  - 양방향으로 동시에 정보프레임과 응답 프레임을 교차하여 전송하는 경우가 일반적
- 피기배킹을 사용하지 않는 경우
  - ![image-20230227165026183](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227165026183.png)
  - 개별 정보 프레임에 대해 긍정 응답 혹은 부정 응답 프레임이 순서 번호와 함께 별도 처리

- 피기배킹을 사용하는 경우
  - ![image-20230227165125232](../../../../../../AppData/Roaming/Typora/typora-user-images/image-20230227165125232.png)
  - 정보 프레임과 응답 프레임을 각각 보내는 것이 아니라 정보 프레임을 전송하면서 응답 기능까지 동시에 수행하도록 프레임 구조 변경
  - 정보 프레임의 표기 방식은 `I(i,j)`로 재정의
  - i는 자신이 전송하는 데이터의 순서 번호, j는 제대로 수신한 프레임의 순서 번호를 의미
  - 응답 프레임을 전송할 시점에 전송할 정보 프레임이 없는 경우
    - 1) 응답 프레임만 전송
    - 2) 응답을 잠시 늦춘 후 피기배킹 방식으로 전송
      - 얼마동안 늦출 것인가? 라는 질문이 남는다.

